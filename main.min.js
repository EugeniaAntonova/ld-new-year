"use strict";let cardOpener=document.querySelector(".js-open-card"),card=document.querySelector(".card-backdrop"),closeButton=document.querySelector(".remove-card-button");function showCard(){card.classList.add("show"),closeButton&&closeButton.addEventListener("click",removeCard),window.addEventListener("keydown",handleEsc),card.addEventListener("click",handleSideClick)}function removeCard(){function e(r){console.log(r.target),r.target==card&&(card.classList.remove("show"),card.classList.remove("out"),card.removeEventListener("animationend",e)),card.removeEventListener("click",handleSideClick),window.removeEventListener("keydown",handleEsc),closeButton&&closeButton.removeEventListener("click",removeCard,{once:!0})}card.classList.add("out"),card.addEventListener("animationend",e)}function handleEsc(e){"Escape"==e.key&&removeCard()}function handleSideClick(e){e.target==card&&removeCard()}cardOpener.addEventListener("click",showCard);const accordeon=document.querySelector(".faq-list"),closePanel=e=>{let r=e.querySelector(".panel");e.classList.remove("opened"),r.style.maxHeight="0"},openPanel=e=>{let r=e.querySelector(".panel");e.classList.add("opened"),r.style.maxHeight=`${r.scrollHeight+60}px`},onAccordeonClick=e=>{let r=e.target,t=accordeon.querySelector(".opened");if(!r.classList.contains("js-toggle"))return;t&&closePanel(t);let l=r.closest("div");l!=t&&(openPanel(l),t=l)};accordeon.addEventListener("click",onAccordeonClick);const slider=document.querySelector("#slider"),slides=[...slider.children],controls=document.querySelectorAll(".container-controls"),prevBtn=document.querySelector(".container-controls.left"),nextBtn=document.querySelector(".container-controls.right");let sectionWidth=slider.querySelector(".section").offsetWidth,slidesPerView=Math.round(slider.offsetWidth/sectionWidth);window.addEventListener("resize",()=>{sectionWidth=slider.querySelector(".section").offsetWidth,slidesPerView=Math.round(slider.offsetWidth/sectionWidth)}),slides.slice(-slidesPerView).reverse().forEach(e=>{slider.insertAdjacentHTML("afterbegin",e.outerHTML)}),slides.slice(0,slidesPerView).forEach(e=>{slider.insertAdjacentHTML("beforeend",e.outerHTML)}),controls.forEach(e=>{e.addEventListener("click",()=>{slider.scrollLeft+="left"===e.id?-sectionWidth:sectionWidth})});const infiniteScroll=()=>{0===slider.scrollLeft?(slider.classList.add("no-transition"),slider.scrollLeft=slider.scrollWidth-2*slider.offsetWidth,slider.classList.remove("no-transition")):Math.ceil(slider.scrollLeft)===slider.scrollWidth-slider.offsetWidth&&(slider.classList.add("no-transition"),slider.scrollLeft=slider.offsetWidth,slider.classList.remove("no-transition"))};slider.addEventListener("scroll",infiniteScroll);const header=document.querySelector("header.inner-header"),callback=e=>{e.forEach(e=>{if(e.isIntersecting){let r=e.target.dataset.sectionName;e.target.style.scrollBehavior="auto",e.target.scrollTop=-e.target.scrollHeight,e.target.style.scrollBehavior="smooth";let t=header.querySelector(".header-current-title");t.textContent=r}e.target.style.scrollBehavior="auto",e.target.scrollTop=-e.target.scrollHeight,e.target.style.scrollBehavior="smooth"})},observer=new IntersectionObserver(callback,{threshold:.1});slides.forEach(e=>{observer.observe(e)}),slides.forEach(e=>{e.addEventListener("scroll",()=>{let r=e.querySelector(".marker");r.getBoundingClientRect().top<50?header.classList.add("bkg-col"):header.classList.remove("bkg-col")})});const mainPage=document.querySelector(".main-page"),mainPageLink=mainPage.querySelector(".main-page-link"),mainPageLinkClick=e=>{e.preventDefault();let r=e.target.dataset.section;slider.classList.add("no-transition"),slider.querySelector(`#${r}`).scrollIntoView(),mainPage.classList.remove("open"),slider.classList.remove("no-transition")};mainPageLink.addEventListener("click",mainPageLinkClick);const burgers=Array.from(document.querySelectorAll("button.burger")),burgerMenu=document.querySelector("section.burger-menu"),burgerMainPageLink=document.querySelector(".burger-main-page-link"),burgerLinks=document.querySelectorAll(".burger-link"),onBurgerClick=e=>{burgers.forEach(e=>{if(e.classList.toggle("closed"),!e.classList.contains("closed")){burgerMenu.classList.add("open");return}burgerMenu.classList.remove("open")})},switchOffBurgers=()=>{burgers.forEach(e=>{e.classList.add("closed")})},onBurgerLinkClick=e=>{if(e.preventDefault(),e.target.classList.contains("burger-main-page-link"))return;let r=e.target.dataset.section;slider.classList.add("no-transition"),slider.querySelector(`#${r}`).scrollIntoView(),burgerMenu.classList.remove("open"),mainPage.classList.remove("open"),switchOffBurgers(),slider.classList.remove("no-transition")},onMainLinkClick=e=>{e.preventDefault(),mainPage.classList.add("open"),document.body.classList.add("light"),burgerMenu.classList.remove("open"),switchOffBurgers()};burgers.forEach(e=>{e.addEventListener("click",onBurgerClick)}),burgerMainPageLink.addEventListener("click",onMainLinkClick),burgerLinks.forEach(e=>{e.addEventListener("click",onBurgerLinkClick)});const currentPlayerContainer=document.querySelector("#current-player-wrapper"),currentPlayerAction=document.querySelector(".current-player-action"),currentPlayerScore=document.querySelector(".current-player-score"),currentPlayerPlace=document.querySelector(".current-player-place"),playersList=document.querySelector(".rating-list"),playerTemplate=document.querySelector("#player-template").content,winnersList=document.querySelector(".winners-list"),animateValue=(e,r,t)=>{let l=null,o=t-r,n=o/1e3,s=t=>{l||(l=t);let a=Math.min((t-l)/n,1);e.textContent=`${(r+Math.floor(a*o)).toLocaleString().replaceAll(","," ")}`,a<1&&window.requestAnimationFrame(s)};window.requestAnimationFrame(s)},scoreOperations=e=>{let r=.03*e,t=645e4+r,l=document.querySelector(".js-prize-value");animateValue(l,645e4,t);let o=[...document.querySelectorAll(".js-prizes-prize")];for(let n=0;n<o.length;n++)switch(n){case 0:o[n].textContent=`${Math.floor(2e6+.1*r).toLocaleString().replaceAll(","," ")} \u20B8`;break;case 1:o[n].textContent=`${Math.floor(12e5+.075*r).toLocaleString().replaceAll(","," ")} \u20B8`;break;case 2:o[n].textContent=`${Math.floor(7e5+.075*r).toLocaleString().replaceAll(","," ")} \u20B8`;break;case 3:o[n].textContent=`${Math.floor(4e5+.075*r).toLocaleString().replaceAll(","," ")} \u20B8`;break;case 4:o[n].textContent=`${Math.floor(3e5+.075*r).toLocaleString().replaceAll(","," ")} \u20B8`;break;case 5:o[n].textContent=`${Math.floor(15e4+.05*r/2).toLocaleString().replaceAll(","," ")} \u20B8`;break;case 6:o[n].textContent=`${Math.floor(1e5+.05*r/3).toLocaleString().replaceAll(","," ")} \u20B8`;break;case 7:o[n].textContent=`${Math.floor(5e4+.25*r/15).toLocaleString().replaceAll(","," ")} `;break;case 8:o[n].textContent=`${Math.floor(1e4+.25*r/25).toLocaleString().replaceAll(","," ")}`}},createPlayer=e=>{let{nick:r,place:t,score:l,bgUserToken:o}=e,n=playerTemplate.cloneNode(!0);if(n.querySelector(".nick").textContent=r,n.querySelector(".place").textContent=t,n.querySelector(".score").textContent=Math.floor(l/100).toLocaleString().replaceAll(","," "),10>=parseInt(t)){let s=document.createElement("img");s.src=`https://sz.kz/picture?bgAvatar=${o}`,n.querySelector(".winner-avatar").append(s)}return n},createAnchor=e=>{if(e){let r=playersList.children;r[e.place-1].id="current-in-the-list",r[e.place-1].classList.add("current-player");let t=document.querySelector("#current-in-the-list");e.place<=100&&e.place>5&&(currentPlayerAction.classList.add("ready"),currentPlayerAction.addEventListener("click",()=>{t.scrollIntoView({block:"center"})}))}else currentPlayerContainer.style.display="none"},onSuccessPlayers=(e,r,t)=>{e.forEach(e=>{let r=t(e);playersList.appendChild(r)}),r&&(currentPlayerPlace.textContent=r.place,currentPlayerScore.textContent=Math.floor(r.score/100).toLocaleString().replaceAll(","," ")),createAnchor(r)},onFail=e=>{console.log(e)},getData=async(e,r,t,l)=>{try{let o=await fetch("https://sz.kz/srvNew?srv=lrRating&lotteryRace=58&offset=101");if(!o.ok)throw Error("Не удалось получить данные");let n=await o.json(),s=n.data,a=!!n.currentUser&&n.currentUser,c=n.allScore?n.allScore:0;l(c),e(s,a,t)}catch(i){r(i.message)}};document.addEventListener("DOMContentLoaded",()=>{getData(onSuccessPlayers,onFail,createPlayer,scoreOperations)});